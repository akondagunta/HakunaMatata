<html>

<head>
    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="introjs/intro.min.js"></script>
    <link href="introjs/introjs.min.css" rel="stylesheet" />
</head>

<body>
    <button class="btn btn-primary" onclick="startIntro();">Start Training</button>
    <h2 id="step1">Hello World!</h2>
    <p id="step2">this is some other content</p>
</body>

<script type="text/javascript">
    var InCloudTrnAppUrl = "https://hakunamatata.firebaseio.com";
    var InCloudTrnID = "-JhaPh6cH3KWGNK4sGIX";
    var pageUrl = location.protocol + '//' + location.host + location.pathname;
    var trainingStepsUrl = InCloudTrnAppUrl + "/steps/" + InCloudTrnID + "/.json";
</script>

<script type="text/javascript">
    function startIntro() {
        $.getJSON(trainingStepsUrl, function (data) {
            var training = {
                steps: []
            };

            var intro = introJs();
            var foundCurrentPage = false;
            var onCompleteIsSet = false;

            for (var key in data) {
                if (data.hasOwnProperty(key)) {
                    //check if the step is for this page
                    if (window.location.pathname.indexOf(data[key].page) > -1) {
                        var stepData = {};
                        stepData["intro"] = data[key].content;
                        stepData["element"] = data[key].element;
                        training.steps.push(stepData);
                        foundCurrentPage = true;

                    } else if (foundCurrentPage && !onCompleteIsSet) {
                        //set a callback for when the steps are completed on this page
                        intro.oncomplete(function () {
                            //head over to the next page!
                            window.location.href = data[key].page;
                        });
                        onCompleteIsSet = true;
                    }
                }
            }

            //TODO: use to record user steps completed for saving progress/analytics
            intro.onchange(function (target) {
                console.info("step");
            });
            intro.setOptions(training);
            intro.start();

        }).fail(function () {
            console.log("error");
        });
    }

    /*
    $(document).ready(function () {
        if (getParameterByName('InCloudTrnMultiPage') && getParameterByName('InCloudTrnMultiPage') == 'true') {
            var stepNum = getParameterByName('InCloudTrnStepNum');
        }
    });
    */

    /* 
    MULTI-PAGE TRIAL:
    function startIntro() {
        $.getJSON(trainingStepsUrl, function (data) {
            var training = {
                steps: []
            };

            var IsTrnMultiPage = false;
            var InCloudTrnNextPage = "";

            for (var key in data) {
                if (data.hasOwnProperty(key)) {
                    var stepData = {};
                    stepData["intro"] = data[key].content;
                    stepData["element"] = data[key].element;
                    if (data[key].page == pageUrl) {
                        training.steps.push(stepData);
                    } else {
                        IsTrnMultiPage = true;
                        InCloudTrnNextPage = data[key].page + '?InCloudTrnMultiPage=true&InCloudTrnStepNum=' + data[key].number;
                    }
                }
            }


            if (IsTrnMultiPage) {
                var intro = introJs();
                intro.setOptions(training);
                intro.setOption('doneLabel', 'Next page').start().oncomplete(function () {
                    window.location.href = InCloudTrnNextPage;
                });
            } else {
                var intro = introJs();
                intro.setOptions(training);
                intro.start();
            }
            // intro.start();
        }).fail(function () {
            console.log("error");
        });
    }

      function getParameterByName(name) {
          name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
          var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
              results = regex.exec(location.search);
          return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
      }
      */
</script>

</html>